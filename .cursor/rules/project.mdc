---
description: Project context and conventions for the Omi WhatsApp integration
alwaysApply: true
---

# Omi WhatsApp Integration

A production app live on the Omi App Store. It sends WhatsApp meeting recaps and lets users send messages to contacts via Omi's AI chat tools.

## Key Docs

- `docs/prd.md` — product requirements, features, edge cases
- `docs/tech-stack.md` — architecture, dependencies, project structure

## Stack

- Node.js 22 + TypeScript + Express
- `@whiskeysockets/baileys` for WhatsApp (QR auth, contacts, messaging)
- Single process, in-memory state (no database)
- Deployed with pm2, sessions persisted to disk

## Conventions

- This is production — prioritize correctness, reliability, and clean code over speed of shipping.
- No LLMs. Omi's `structured` payload already provides title, overview, and action items.
- One concern per file. Routes in `src/routes/`, services in `src/services/`, types in `src/types/`.
- Always handle the `uid` query parameter — it identifies the Omi user.
- Return `200 OK` quickly from webhooks. Do async work after responding when possible.
- Log with pino. Use `info` level in production, `debug` for local dev.

## Endpoints

- `GET /setup` — QR code page for WhatsApp linking
- `GET /setup/status` — returns `{is_setup_completed: bool}` for Omi polling
- `POST /webhook/memory` — receives Omi memory, sends WhatsApp recap
- `POST /tools/send_message` — Omi chat tool: send a WhatsApp message to a contact
- `POST /tools/send_recap_to_contact` — Omi chat tool: send meeting recap to a contact
- `POST /tools/send_meeting_notes` — Omi chat tool: send meeting notes to self
- `POST /tools/set_reminder` — Omi chat tool: schedule a WhatsApp reminder

## Edge Cases to Always Handle

- Skip discarded memories (`discarded: true`)
- Gracefully handle missing WhatsApp sessions (user not linked yet)
- Chat tools return JSON — use descriptive error messages Omi's LLM can relay to the user
